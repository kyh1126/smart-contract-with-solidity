# Chapter 11. 오라클

## 개요

이번 장에서는 외부의 데이터를 이더리움 스마트 컨트랙트로 제공하는 오라클에 대해 알아봅니다.
오라클이라는 명칭은 그리스 신화에서 신의 계시를 전달하고 미래의 모습을 보는 사람이라는 뜻에서 유래되었습니다. 이상적으로 오라클은 신뢰가 필요없는 (trustless)시스템인데, 그 이유는 탈중앙화 원칙을 바탕으로 작용하기 때문입니다.

→ 이 장의 결론은 스마트 컨트랙트에서 외부데이터를 가져와야 하는데 오라클이 사용되며, 가스비를 낭비하지 않고 데이타를 계산하는데에도 사용된다는 것. 신뢰성을 확보하기 위해 탈중앙화 오라클을 쓰는 방향


## 1.오라클은 왜 필요한가

이더리움 가상머신은 탈중앙화된 네트워크상의 노드에서 합의 규칙에 따라 이더리움 프로그램을 실행, 상태를 업그레이드 할수 있다. 결정론적이며 이더리움 상태와 서명된 트랜잭션의 공유 컨텍스트에 기반을 두고 있기 때문에 임의성을 위한 고유한 코드가 없으며 외부데이터가 트랜잭션의 데이터 페이로드로서만 유입될수 있다는 것..

외부 정보를 네트워크로 전송하는 트랜잭션 데이터의 일부로 포함시키면 출처를 확인할수 없어 **신뢰성이 떨어진다. 이 문제를 해결하기 위해 오라클**을 사용한다.


## 2.오라클 유스케이스과 사례

오라클은 이상적으로 스마트 컨트랙트를 위해 이더리움 플랫폼으로 축구경기의 결과나 금 가격, 혹은 순수 난수와 같은 외부 정보를 가지고 오는데 신뢰가 필요 없는 방법을 사용한다.

오라클은 오프체인세계와 스마트 컨트랙트사이의 격차를 줄이기위한 메커니즘이라고 볼수 있다.

오라클이 제공할수 있는 데이터의 예

- 환율 데이터
- 자본 시장 데이터
- 물리적인 소스로부터 발생되는 난수
- 날씨 데이터: 일기 예보에 기초한 보험료 계산
- 정치적 사건: 예측 시장 결과
- 스포츠 이벤트: 예측 시장 결과 제공 및 판타지 스포츠 컨트랙트


## 3. 오라클 디자인 패턴

모든 오라클은 정의에 따라 몇가지 핵심 기능을 제공한다.

- 오프체인 소스에서 데이터를 수집
- 데이터를 서명된 메시지로 온체인에 전송
- 데이터를 스마트 컨트랙트의 스토리지에 저장하여 사용할수 있게 만듬

오라클 디자인 패턴은 크게 3가지로 분류된다

- 요청-응답
- 게시-구독
- 즉시 읽기

**즉시 읽기**

'이 사람이 18세 이상인가'와 같은 즉각적인 결정이 필요한 데이터만을 제공

이러한 데이터는 한번 조회하고 나면 아마도 다시 수행하지 않는 경향이 있음

- 학술 인증서, 전화번호, 기관 회원권, 공항 식별자, id

**게시-구독**

잦은 변화가 예상되는 데이터를 브로드 캐스트하는 역할. 데이터를 받는 쪽에서 최신 정보가 변경되었는지 기다리다가 업데이트가 발생하면 필요한 조치를 수행한다

- 가격정보, 기상정보, 경제 또는 사회 통계, 교통정보

**요청-응답**

스마트 컨트랙트에 저장하기에 데이타 공간이 너무 큰데, 사용자는 한번 사용시 전체 데이터중 일부만 필요한 경우에 사용된다.

1. DApp으로부터 질의(쿼리)를 받는다. (요청)
2. 질의를 분석하고 비용 지불 여부, 접근 권한 여부를 확인한다.
3. 오프체인 소스에서 데이터를 검색한다.
4. 트랜잭션에 데이터를 포함시켜 서명하고 네트워크로 브로드캐스트한다. (응답)
5. 알림 등 필요한 추가 트랜잭션을 스케줄링한다.

→ 둘사이의 차이는 댑으로부터 직접 메시지를 보내는가의 차이


## 데이터 인증

데이터 소스가 신뢰할수 있다고 가정한뒤 오라클과 요청-응답 메커니즘이 별개의 주체에 대해 운영된다면 어떻게 이 매커니즘을 신뢰할수 있는가? 이에는 메커니즘에 대한 진위성을 증명하는것과 그것이 이루어지는 환경을 신뢰할수 있게 하는 두가지 방법이 존재한다.

### 진위성 증명(authenticity proof)

- 데이터가 변조되지 않았음을 **암호학적으로 보증하는 것**이다. 오라클라이즈는 다양한 진위성 증명을 활용하는 오라클 서비스의 예이다. 증명 중 하나로 클라이언트 서버 간에 HTTPS 웹 트래픽이 발생했다는 증거를 제 3자에게 제공할 수 있는 TLSNotary 증명이 있다. 이 증명을 사용해 클라이언트와 서버간에 https트래픽이 발생했다는 증거를 제3자한테 제공하는 방식.

### 신뢰할 수 있는 실행 환경(TEE)

- 타운 크리에(Town Crier)는 tef접근방식의 데이터 피드 오라클 시스템. sgx를 사용하여 해당 빌드의 해시로 확실하게 식별된 앱이 보안 영역 내에서 실행된다는 디지털 서명을 생성하여 인증하는 방식.


## 계산 오라클

앞서 설명한 데이터를 요청하고 전달하는 맥락에서의 오라클 뿐 아니라 **특정부분에서 유용할수 있는 임의의 계산을 수행**하는데 오라클이 사용될 수도 있다(이더리움의 자원을 절약가능)

단지 질의결과를 전달하는 중간다리 역할에 그치는 것이 아닌, 실제 온체인상에서 실행불가능한 계산에 대한 입력값을 받아 결과를 리턴하는데도 사용 된다.

중앙화되어있지만 감사 가능한 서비스를 신뢰한다면 아래 서비스들을 사용해볼만 하다.

**오라클라이즈**

영국 런던에 있는 데이터 제공회사로 현실 세계의 다양한 데이터를 수집하여 스마트 계약을 운영하려는 블록체인 네트워크에게 API 방식으로 제공해 주는 오라클 서비스를 하고 있다. 샌드박스형 aws가상머신을 통해 탈중앙화된 앱 결과를 요청할수 있는 서비스를 제공한다. 물론 탈중앙 아님.

[http://wiki.hash.kr/index.php/오라클라이즈](http://wiki.hash.kr/index.php/%EC%98%A4%EB%9D%BC%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%A6%88)

**트루비트** [https://truebit.io/](https://truebit.io/)

최근 다양하게 제시되고 있는 확장성 솔루션들은 메인체인의 트랜잭션 처리성능을 개선하여 TPS를 높이는데 중점을 둔 경우가 많다. **샤딩이나 플라즈마 등 많은 솔루션들이 이에 해당**한다. 이에 반해 트루빗은 이더리움의 TPS가 아닌, 이더리움에서 처리할 수 있는 연산 성능의 한계를 극복하기 위해 등장한 확장성 오프체인 솔루션이다.

조금 더 탈중앙화된 솔루션, 계산자와 검증자 시스템을 사용하며 계산의 수행과 계산의 검증에 대해 보상을 제공하는 방식. 어떤 계산 결과에 대해 챌린지가 나오면 계산의 하위 집합에 대한 반복적인 **검증 프로세스를 온체인에서 수행**, 일련의 라운드를 진행할수록 온체인에서 수행될만큼 충분히 작아진 데이타를 가지고 채굴자가 최종판결을 하는 식.

> *도지더리움의 인터체인 방식은 이렇다. 도지코인에서 특정 계좌로 돈을 보내고 거래를 발생시키면 돈의 소유권이 해당 계좌로 넘어간다. 이를 ‘락(lock) 과정’이라 한다. 보낸 돈의 총액만큼 이더리움상에서 ERC-20 토큰으로 발급해주면 원래 갖고 있던 양만큼의 도지 코인이 이더리움상의 ERC-20토큰으로 생성된다. 반대로, 원래 갖고 있던 ERC-20토큰을 없애버리고 없앤 양만큼의 도지코인을 받으면 다시 도지코인이 생기는 것이다. 이 과정을 스마트 콘트랙트로 처리하도록 한 게 도지더리움이다.
그러나 구체적인 과정은 앞의 설명만큼 간단하진 않다. 거래 검증에 엄청난 연산이 필요하기 때문이다. 박 연구원은 “락(lock) 관련 거래를 검증하는 데에는 엄청난 연산 작업이 필요하다”며 “이 작업을 모두 스마트 콘트랙트에 올려 검증하려면 **하루에 1만 달러나 든다”**고 설명했다.

더 빠른 컴퓨팅 작업을 위해 종종 쓰이는 **트루빗은 연산을 이더리움에서 하지 않고 외부(로컬 컴퓨터)에서 한다. 결과 값만 이더리움 블록체인에 담는 꼴이다.***


## 탈중앙 오라클

앞서 설명한 중앙화 오라클은 이더리움 네트워크에서는 단일 실패지점이 되어 해커의 타겟이 되기 쉽다. 이러저러한 이유때문에 탈중앙화 오라클에 대한 여러 아이디어가 제안된바 있다.

**체인링크**

**쉘링코인**


## 결론

오라클은 스마트 컨트랙트에 외부서비스를 가져오는 중요한 기능을 한다. 그러나 신뢰가 필요한 소스인데 부정이 일어난다면 스마트 컨트랙트에 심각한 오류를 야기하므로, 신뢰모델에 대해 신중해야 한다. 이러한 우려사항의 대안이 될수 있는것이 **탈중앙화 오라클이며 신뢰가 필요없는 외부 데이터를 제공 할수 있다**. 늘 신중해라!